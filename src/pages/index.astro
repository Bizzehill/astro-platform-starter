---
import Layout from '../layouts/Layout.astro';
import LinkGrid from '../components/LinkGrid';

// Check cookies for authentication
const cookies = Astro.request.headers.get('cookie') || '';
const isAuthenticated = cookies.includes('authenticated=true');
const emailCookie = cookies.split(';').find(c => c.trim().startsWith('userEmail='));
const email = emailCookie ? decodeURIComponent(emailCookie.split('=')[1].trim()) : '';

// Debugging
console.log("Auth status on index page:", isAuthenticated);
console.log("Email from cookie:", email);

// If not authenticated, redirect to login
if (!isAuthenticated || !email.endsWith('@steemer.com')) {
  console.log("Not authenticated, redirecting to login");
  return Astro.redirect('/login', 302);
}
---

<Layout title="Stanley Steemer Location Maps">
  <main class="container mx-auto px-4 py-8">
    <h1 class="text-3xl font-bold text-center mb-8">Location Territory-Zone Maps</h1>
    <LinkGrid client:load />
  </main>
</Layout>
