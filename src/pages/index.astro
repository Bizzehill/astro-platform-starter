---
import Layout from '../layouts/Layout.astro';
import LinkGrid from '../components/LinkGrid';

// Helper function for parsing cookies
const parseCookies = (cookieHeader) => {
  return Object.fromEntries(
    cookieHeader.split('; ').map(cookie => {
      const [key, ...value] = cookie.split('=');
      return [key, decodeURIComponent(value.join('='))];
    })
  );
};

const cookies = parseCookies(Astro.request.headers.get('cookie') || '');
const isAuthenticated = cookies.authenticated === 'true';
const email = cookies.userEmail || '';

// Debugging logs
console.log("Auth status on index page:", isAuthenticated);
console.log("Email from cookie:", email);

// Redirect if not authenticated or invalid email
if (!isAuthenticated || !email.endsWith('@steemer.com')) {
  console.log("Not authenticated or invalid email domain, redirecting to login");
  return Astro.redirect('/login', 302);
}
---

<Layout title="Stanley Steemer Location Maps">
  <main class="container mx-auto px-4 py-8">
    <h1 class="text-3xl font-bold text-center mb-8">Location Territory-Zone Maps</h1>
    <LinkGrid client:load />
  </main>
</Layout>

